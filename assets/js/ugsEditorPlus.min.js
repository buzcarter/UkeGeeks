/**
 * <ul>
 * <li>Project: UkeGeeks' Song-a-matic Editor</li>
 * <li>Homepage: http://ukegeeks.com</li>
 * <li>Project Repository: https://github.com/buzcarter/UkeGeeks</li>
 * <li>Author: Buz Carter</li>
 * <li>Contact: buz@ukegeeks.com</li>
 * <li>Copyright: Copyright 2010-2014 Buz Carter.</li>
 * <li>License GNU General Public License (http://www.gnu.org/licenses/gpl.html)</li>
 * </ul>
 *
 * <h3>Overview</h3>
 * This library implments the UkeGeeks Scriptasaurus Song-a-matic editor functions, bridging the page UI and scriptasaurus methods.
 *
 * @module ugsEditorPlus
 * @main ugsEditorPlus
 **/
var ugsEditorPlus = window.ugsEditorPlus || {};
;ugsEditorPlus.options={useLegacyIe:!1,showEditOnLoad:!0,fontSize:12,diagramSize:100,diagramPosition:"left",lyricStyle:"above",paper:"letter",theme:"normal",tuning:"soprano",hideChordEnclosures:!1,sortAlphabetical:!1,ignoreCommonChords:!1,commonChords:[]};
ugsEditorPlus.actions=function(){var b={},c={},a=null,h=null,g=[],d=/^([A-G][#b]?)(m|m6|7|m7|dim|maj7|6|sus2|sus4|aug|9)?$/,f={placement:"above",transpose:"up_0"};b.init=function(){c={songText:document.getElementById("ukeSongText"),songContainer:document.getElementById("ukeSongContainer"),cpmSource:document.getElementById("chordProSource"),scalableArea:document.getElementById("scalablePrintArea")};$(document).on("option:click",function(a,l){var u=l.action,f=l.value,y=!1;switch(u){case "zoomFonts":t(f);
break;case "zoomDiagrams":w(f);break;case "layout":m(f);break;case "placement":y=n(f);break;case "tuning":e(f);y=!0;break;case "colors":ugsEditorPlus.themes.set(f);y=!0;break;case "transpose":u="u"==f[0]?1:-1;f=parseInt(f[f.length-1],10);var f=u*f,A=[],u="",r;for(r=0;r<g.length;r++)d.test(g[r])?A.push(g[r]):u+=g[r]+", ";if(!(0<u.length)||confirm("Sorry, but some of your chords can't be transposed:\n"+u+"\n\nDo you want to continue anyway?")){var z=ukeGeeks.transpose.shiftChords(A,f),u=h,v;for(r=0;r<
A.length;r++)v=new RegExp("\\["+A[r]+"\\]","g"),u=u.replace(v,"[ugsxx_"+r+"]");for(r=0;r<z.length;r++)v=new RegExp("\\[ugsxx_"+r+"\\]","g"),u=u.replace(v,"["+z[r]+"]");v=/^\s*\{\s*(key|k)\s*:\s*(\S*?)\s*\}\s*$/im;v.test(u)&&(A=u.match(v),r=A[2],""!==r&&d.test(r)&&(u=u.replace(v,A[0].replace(r,ukeGeeks.transpose.shift(r,f)))));c.cpmSource.value=u;b.run()}break;case "paper":k(f);break;case "showEnclosures":ukeGeeks.settings.opts.retainBrackets=f;y=!0;break;case "hideCommonChords":ukeGeeks.settings.opts.ignoreCommonChords=
f;y=!0;break;case "sortAlphabetical":ukeGeeks.settings.opts.sortAlphabetical=f;y=!0;break;case "setCommonChords":p(f);y=ukeGeeks.settings.opts.ignoreCommonChords;break;case "update":b.run(!0);break;default:console.log("Unrecognized "+u+" > "+f)}y&&b.run()});l(ugsEditorPlus.options)};var l=function(a){t(a.fontSize);w(a.diagramSize);m(a.diagramPosition);k(a.paper);ugsEditorPlus.themes.set(a.theme);e(a.tuning);n(a.lyricStyle);ukeGeeks.settings.opts.retainBrackets=!a.hideChordEnclosures;ukeGeeks.settings.opts.ignoreCommonChords=
a.ignoreCommonChords;p(a.commonChords);ukeGeeks.settings.opts.sortAlphabetical=a.sortAlphabetical};b.run=function(m){m=0<arguments.length&&m;c.songText.innerHTML="<pre>"+c.cpmSource.value+"</pre>";a=ukeGeeks.scriptasaurus.run();1>a.chords.length&&ugsEditorPlus.autoReformat.run(c);if(a&&(ugsEditorPlus.songUi.update(a),m||null===h)){h=c.cpmSource.value;g=a.chords;var e=""!==a.key?a.key:1>a.chords.length?"":a.chords[0],d=document.getElementById("transposeOptions").getElementsByTagName("li"),b,n=-6;f.transpose=
"up_0";ugsEditorPlus.submenuUi.resetTransposeLabel();for(var k=0;k<d.length;k++)ukeGeeks.toolsLite.removeClass(d[k],"checked"),b=1>e.length?"":ukeGeeks.transpose.shift(e,n),d[k].getElementsByTagName("em")[0].innerHTML=b,0===n&&ukeGeeks.toolsLite.addClass(d[k],"checked"),n++}};var t=function(a){a=parseFloat(a,10);c.scalableArea.style.fontSize=a+"pt"},w=function(a){a=parseInt(a,10)/100;var m=Math.round(225*a),c=ugsEditorPlus.styles.getSheet("ugsEditorCss"),e=c.find(".scalablePrintArea .ugs-diagrams-wrap canvas");
e.style.width=Math.round(a*ukeGeeks.settings.fretBox.width)+"px";e.style.height=Math.round(a*ukeGeeks.settings.fretBox.height)+"px";c.find(".scalablePrintArea .ugs-diagrams-wrap .ugs-diagrams--chord-img svg").style.width=e.style.width;e=c.find(".scalablePrintArea .ugs-diagrams-wrap");e.style.width=m+"px";e=c.find(".scalablePrintArea .ugs-source-wrap");e.style.marginLeft=25+m+"px"},m=function(a){$("body").toggleClass("diagramsOnTop","top"==a).toggleClass("diagramsOnSide","left"==a).toggleClass("ugsHideDiagrams",
"none"==a)},n=function(a){var m=!1;ukeGeeks.toolsLite.setClass(c.songContainer,"ugsInline","inline"==a);var e="miniDiagrams"==a;e||ukeGeeks.toolsLite.removeClass(c.songContainer,"ugsInlineDiagrams");e||"miniDiagrams"==f.placement?(ukeGeeks.settings.inlineDiagrams=e,m=!0):e||"miniDiagrams"==f.placement||ukeGeeks.overlapFixer.Fix(c.songText);f.placement=a;return m},k=function(a){for(var m=["letter","a4","screen"],c=$("body"),e=0;e<m.length;e++)c.removeClass("pageWidth_"+m[e]);c.addClass("pageWidth_"+
a)},e=function(a){var m=ukeGeeks.definitions.instrument.sopranoUke,c="Standard <strong>GCEA</strong> Soprano Ukulele";"baritone"==a&&(m=ukeGeeks.definitions.instrument.baritoneUke,c="Standard <strong>DGBE</strong> Baritone Ukulele");$("#footTuningInfo").html(c);ukeGeeks.scriptasaurus.setTuningOffset(m)},p=function(a){if("string"==typeof a){a=a.split(/[ ,]+/);for(var m=[],c=0;c<a.length;c++){var e=ukeGeeks.toolsLite.trim(a[c]);0<e.length&&m.push(e)}a=m}ukeGeeks.settings.commonChords=a};return b}();
ugsEditorPlus.songUi=function(){var b={},c=function(a,c){var b=c&&0<c.length,d=document.getElementById(a);d&&(d.innerHTML=b?c:"",d.style.display=b?"block":"none")};b.update=function(a){var b=document.getElementById("songTitle");b.innerHTML=0<a.title.length?a.title:"Untitled-Song";c("songArtist",a.artist);c("songAlbum",a.album);c("songSubtitle",a.st);b=document.getElementById("songMeta");if(!a.ugsMeta||1>a.ugsMeta.length)b.style.display="none";else{for(var g="",d=0;d<a.ugsMeta.length;d++)g+="<p>"+
a.ugsMeta[d]+"</p>";b.innerHTML=g;b.style.display="block"}};return b}();
ugsEditorPlus.styles=function(){var b={Rules:null},c=null;b.getSheet=function(a){a:{for(var h=0;h<document.styleSheets.length;h++)if(document.styleSheets[h].title==a){c=document.styleSheets[h];break a}c=null}a=null==c?[]:c.cssRules?c.cssRules:c.rules;b.Rules=a;return this};b.find=function(a){a=a.toLowerCase();for(var c=0;c<b.Rules.length;c++)if(b.Rules[c].selectorText&&b.Rules[c].selectorText.toLowerCase()==a)return b.Rules[c];return null};return b}();
ugsEditorPlus.themes=function(){var b={},c={normal:{name:"Normal (white paper)",selectText:"Normal colors (white paper)",description:"Simple, legible text on white paper",song:{fretLines:"#003366",dots:"#ff0000",dotText:"#ffffff",text:"#000000",fretText:"#4a4a4a"},tabs:{lines:"#999999",dots:"#eaeaea",text:"#000000"}},reversed:{name:"Reversed for projectors",selectText:"Reversed colors (for projectors)",description:"Light text on dark background",song:{fretLines:"#365F70",dots:"#FDD96F",dotText:"#000000",
text:"#FF6040",fretText:"#999999"},tabs:{lines:"#365F70",dots:"#FDD96F",text:"#000000"}},frosty:{name:"Frostcicle",selectText:"Frostcicle (cool blue)",description:"Brrrr... icy cool blues",song:{fretLines:"#66B4CC",dots:"#332335",dotText:"#9FE1F9",text:"#0896FE",fretText:"#E3D8BA"},tabs:{lines:"#6699FF",dots:"#EFFCF9",text:"#00558E"}},jellyBean:{name:"Jelly Beans",selectText:"Jelly Beans (vibrant)",description:"Sugary, vibrant bowl of jelly beans!",song:{fretLines:"#49BC45",dots:"#FF9417",dotText:"#FCF49F",
text:"#D20070",fretText:"#4a4a4a"},tabs:{lines:"#6699FF",dots:"#FFF9BA",text:"#75003E"}},justBlack:{name:"Just Black",selectText:"Black (for laser printers)",description:"No color, but black, best for B&W laser printers",song:{fretLines:"#cccccc",dots:"#000000",dotText:"#ffffff",text:"#000000",fretText:"#000000"},tabs:{lines:"#cccccc",dots:"#000000",text:"#ffffff"}},krampus:{name:"Gruss vom Krampus",selectText:"Krampus (Ye Olde Christmas)",description:"Seasons Greetin's, Happy Holidays, Merry Christmas, Krampus Nichte!",
song:{fretLines:"#929867",dots:"#A22C27",dotText:"#EBD592",text:"#4F2621",fretText:"#4a4a4a"},tabs:{lines:"#B69C01",dots:"#E1EEC8",text:"#75003E"}},western:{name:"Out West",selectText:"Out West (dust country)",description:"Dusty Honky Tonk/Country/Western look",song:{fretLines:"#B5A679",dots:"#CF8300",dotText:"#ffffff",text:"#386571",fretText:"#4a4a4a"},tabs:{lines:"#697665",dots:"#F1E3C5",text:"#632424"}},pumpkin:{name:"Pumpkin Pie",selectText:"Pumpkin Pie (fall colors)",description:"Fall 'n Halloween 'n Jack o'Lantern 'n Thanksgiving Fun",
song:{fretLines:"#8E9A6C",dots:"#DA6328",dotText:"#FFEE4A",text:"#68391D",fretText:"#B14623"},tabs:{lines:"#BED379",dots:"#FFF4D8",text:"#B14623"}},notebook:{name:"Rock Notebook",selectText:"Rock Notebook (marker)",description:"A strong, hand-scrawled, and edgily unreliable look",song:{fretLines:"#747CAD",dots:"#1C0866",dotText:"#ffffff",text:"#B22000",fretText:"#A4A0B2"},tabs:{lines:"#A4A0B2",dots:"#F1E3C5",text:"#2E2ECC"}},zombie:{name:"Zombies!!!",selectText:"Zombies!!!",description:"Blood 'n gore for Halloween",
song:{fretLines:"#9EB036",dots:"#E52501",dotText:"#FEDA79",text:"#798666",fretText:"#B14623"},tabs:{lines:"#602749",dots:"#F7F9EA",text:"#4F5F3E"}}};b.getDescription=function(a){return c[a].selectText};b.loadList=function(a,b){var g="",d;for(d in c)c.hasOwnProperty(d)&&(g+='<li class="'+(d==b?"checked":"")+'"><a href="#'+d+'" title="'+c[d].description+'">'+c[d].name+"</a></li>");$(a).html(g)};b.set=function(a){var b=$("body"),g;for(g in c)c.hasOwnProperty(g)&&b.removeClass("theme-"+g);b.addClass("theme-"+
a);a=c[a];ukeGeeks.settings.colors=a.song;ukeGeeks.settings.tabs.lineColor=a.tabs.lines;ukeGeeks.settings.tabs.dotColor=a.tabs.dots;ukeGeeks.settings.tabs.textColor=a.tabs.text};return b}();
ugsEditorPlus.optionsDlg=function(){var b=function(c,a){$.event.trigger("option:click",{action:c,value:a})};return{init:function(){var c,a=ugsEditorPlus.options;document.getElementById("updateBtn").onclick=function(){b("update","");return!1};c=document.getElementById("chkEnclosures");c.checked=a.hideChordEnclosures;c.onclick=function(){b("showEnclosures",!this.checked)};c=document.getElementById("commonChordList");c.value="string"==typeof a.commonChords?a.commonChords:a.commonChords.join(", ");c.onchange=
function(){b("setCommonChords",this.value)};if(c=document.getElementById("chkSortAlpha"))c.checked=a.sortAlphabetical,c.onclick=function(){b("sortAlphabetical",this.checked)};c=document.getElementById("chkIgnoreCommon");c.checked=a.ignoreCommonChords;c.onclick=function(){b("hideCommonChords",this.checked)};$(".checkboxBlock label, input[type=checkbox]").click(function(a){a.stopPropagation()});$(".overlay").draggable({handle:"hgroup"})}}}();var ugsEditorPlus=window.ugsEditorPlus||{};
ugsEditorPlus.reformat=function(){var b={},c=!1,a=function(){this.source="";this.spaceCount=this.wordCount=0;this.words=[];this.lineType=this.chordCount=0},h=/\b(\S+)\b/gi,g=/(\s+)/g,d=/(^\s+)/,f=/\b[A-G][#b]?(m|m6|m7|m9|dim|dim7|maj7|sus2|sus4|aug|6|7|9|add9|7sus4)?\b/,l=/\b(\S+\s*)/g,t=/^\s*(\|{0,2}[A-Gb]?\|{0,2}[-x0-9|:]{4,})/;b.run=function(b){c=!1;var m=[];b=b.replace("\t","    ");b=b.split("\n");for(var n=0;n<b.length;n++){var k=b[n].match(h),e=new a;e.source=b[n];if(null!=k&&0<k.length){e.wordCount=
k.length;e.words=k;for(var p=e,q=0,x=0;x<k.length;x++)k[x].match(f)&&q++;p.chordCount=q}p=b[n].match(g);null!=p&&0<p.length&&(e.spaceCount=p.length);p=e;k=e;1>k.spaceCount+k.wordCount?k=0:null!=k.source.match(t)?k=3:(q=2,0<k.chordCount&&k.wordCount==k.chordCount&&(q=1,c=!0),k=q);p.lineType=k;m.push(e)}n="";for(b=0;b<m.length;)if(e=m[b],p=m[b+1],b++,p&&0!=e.lineType){if(k=3==e.lineType)a:if(b+3>=m.length)k=!1;else{for(k=b;k<b+3;k++)if(3!=m[k].lineType){k=!1;break a}k=!0}if(k)n+="{start_of_tab}\n"+
e.source.replace(d,"")+"\n"+p.source.replace(d,"")+"\n"+m[b+1].source.replace(d,"")+"\n"+m[b+2].source.replace(d,"")+"\n{end_of_tab}\n",b+=3;else if(1!=e.lineType||2!=p.lineType){if(1==e.lineType){e=e.source.replace(g," ").split(" ");p="";for(k=0;k<e.length;k++)0<e[k].length&&(p+="["+e[k]+"] ");e=p+"\n"}else e=e.source+"\n";n+=e}else{b++;q=e.source;for(e=p.source;e.length<q.length;)e+=" ";p="";k=q.match(l);x=q.match(d);q=0;x&&(p+=e.substr(q,x[0].length),q=x[0].length);for(x=0;x<k.length;x++)p+="["+
k[x].replace(g,"")+"]"+e.substr(q,k[x].length),q+=k[x].length;q<e.length&&(p+=e.substr(q,e.length));n+=p+"\n"}}else n+=e.source+"\n";return n};b.hasChords=function(){return c};return b}();
ugsEditorPlus.autoReformat=function(){var b={},c={},a,h=!1;b.run=function(b){h||(c=b,c.reformatTextBox=document.getElementById("reformatSource"),c.reformatDlg=document.getElementById("reformatDlg"),document.getElementById("reformatYesBtn").onclick=function(){c.cpmSource.value=a;g();ugsEditorPlus.actions.run(!0);return!1},document.getElementById("reformatNoBtn").onclick=function(){g();return!1},b=document.getElementById("reformatDisable"),b.checked=!1,b.onclick=function(){h=this.checked},a=ugsEditorPlus.reformat.run(c.cpmSource.value),
c.reformatTextBox.innerHTML=a,ugsEditorPlus.reformat.hasChords()&&ukeGeeks.toolsLite.removeClass(c.reformatDlg,"isHidden"))};var g=function(){ukeGeeks.toolsLite.addClass(c.reformatDlg,"isHidden")};return b}();
ugsEditorPlus.topMenus=function(){var b=function(){var a=$(this).parent(),b=a.hasClass("active");c();b||a.addClass("active")},c=function(){$("#ugsAppToolbar > ul > li").removeClass("active")},a=function(){c();$(".arrowBox").hide()},h=function(c){a();c=$(this).data("dialog");$("#"+c).fadeIn();return!1},g=function(a){$(this).parents(".overlay").fadeOut();return!1},d=function(c){a();c=$(this).parents(".overlay");ugsEditorPlus.resize.toggle(c);return!1},f=function(a){a=$(this).attr("href");$(".arrowBox").not(a).hide();
a=$(a);a.find("dd").hide();a.fadeToggle();ugsEditorPlus.submenuUi.reset(a);return!1};return{init:function(){$("#ugsAppToolbar > ul li").not("[data-dialog]").children("a").click(b);$(".showOptionsBox a").click(f);$("#ugsAppToolbar > ul li[data-dialog]").click(h);$(".closeBtn").click(g);$(".resizeBtn").click(d)},makeAllInactive:c}}();
ugsEditorPlus.submenuUi=function(){var b={},c=null;b.init=function(){ugsEditorPlus.themes.loadList("#colorPicker .pseudoSelect",ugsEditorPlus.options.theme);$(".enablePseudoSelects label").click(g);$(".pseudoSelect li").click(a);$("body").bind("click",l);$(".arrowBox").click(f);for(var c=ugsEditorPlus.options,b,d=[{action:"zoomFonts",value:c.fontSize},{action:"zoomDiagrams",value:c.diagramSize},{action:"layout",value:c.diagramPosition},{action:"paper",value:c.paper},{action:"colors",value:c.theme},
{action:"tuning",value:c.tuning},{action:"placement",value:c.lyricStyle}],e=d.length-1;0<=e;e--)c=$("[data-action="+d[e].action+"] a[href=#"+d[e].value+"]").closest("li"),b=c.closest("dd").attr("id"),h(c),$("label[for="+b+"] span").text(w(d[e].action,d[e].value,c))};var a=function(a){a=$(this);var b;b=a.children().attr("href");b="#"==b[0]?b.substr(1):b;var k=a.parents("dd"),e=k.attr("id"),k=k.data("action");$("#"+e).hide();h(a);d(this,!1);c=null;$("label[for="+e+"] span").text(w(k,b,a));$("label[for="+
e+"]").parents("dt").removeClass("active");$.event.trigger("option:click",{action:k,value:b});return!1},h=function(a){a&&(a.siblings().removeClass("checked"),a.addClass("checked"))},g=function(a){a=$(this);var b=a.attr("for");a.closest("dl").children("dt").removeClass("active");a.closest("dt").addClass("active");$("#"+b).show();d(this,!0);null!==c&&$("#"+c.id).hide();c=null!==c&&c.id==b?null:{id:b};return!1};b.reset=function(a){a.find("dt").removeClass("active");a.find(".event-userSelecting").removeClass("event-userSelecting")};
var d=function(a,c){$(a).parents(".enablePseudoSelects").toggleClass("event-userSelecting",c)},f=function(a){if(!$(a.target).is("a"))return $(this).find("dd").hide(),c=null,!1},l=function(a){$(".arrowBox").fadeOut(270);ugsEditorPlus.topMenus.makeAllInactive()},t={zoomDiagrams:["Tiny","Small","Medium","Large","Stupid Large"],layout:["Reference diagrams on left","Reference diagrams at top","No reference diagrams"],placement:["Chord names inline with lyrics","Chord names above lyrics","Names & diagrams above lyrics"],
tuning:["Soprano (GCEA) tuning","Baritone (DBEA) tuning"]},w=function(a,c,b){var e=b.index();switch(a){case "paper":return"Width "+b.text();case "zoomFonts":return"Font size "+c+"pt";case "zoomDiagrams":return t.zoomDiagrams[e]+" diagrams";case "colors":return ugsEditorPlus.themes.getDescription(c);case "transpose":return"up_0"==c?"Original key":b.text().replace(" ",' steps - "')+'"';default:return t[a][e]}};b.resetTransposeLabel=function(){$("label[for=transposePicker] span").text("Original key")};
return b}();
ugsEditorPlus.newSong=function(){var b={},c=!1,a="";b.init=function(b){a=b;$("#newSongBtn").click(function(a){a=$("#songTitle");var c=a.val().trim();a.val(c);a=2<c.length;g(!a,"Song's title is required<br/><em>(you may change it later, must be at least 2 characters)</em>");a&&h()});$("#openNewDlgBtn").click(function(a){$("#songTitle, #songArtist").val("");$("#newSongForm").fadeIn();$("#songTitle").focus()});$("#hideNewSongBtn").click(d);$("#newSongForm").bind("keydown",f);var t=$("#loadingSpinner");t.hide();
$(document).ajaxStart(function(){t.show();c=!0}).ajaxStop(function(){t.hide();c=!1})};var h=function(){if(!c){var b={handler:"ugs_new",songTitle:$("#songTitle").val(),songArtist:$("#songArtist").val()};$.ajax({url:a,type:"POST",dataType:"json",data:JSON.stringify(b),success:function(a){g(a.HasErrors,a.Message);a.HasErrors||(document.location.href=a.ContinueUri)},error:function(a){g(!0,"Failed to create the song file.<br/>Please have your admin check the CPM directory permissions.")}})}},g=function(a,
c){var b=$("#newSongForm .errorMessage");a?(b.show().html(c),$("#songTitle").focus()):b.hide()},d=function(a){$("#newSongForm").fadeOut()},f=function(a){27==a.which&&d()};return b}();
ugsEditorPlus.updateSong=function(){var b={},c="",a="",h=!1;b.init=function(b,f){c=b;a=f;$("#saveBtn").click(function(a){g();return!1});$("#messageBox").hide();$(document).ajaxStart(function(){$("#sourceFeedback").hide().html();$("#messageBox").slideDown("fast");$("#loadingSpinner").show();h=!0}).ajaxStop(function(){$("#messageBox").delay(3E3).fadeOut("slow");h=!1})};var g=function(){if(!h){$("#sourceFeedback").show();var b={handler:"ugs_update_81jr",filename:a,song:$("#chordProSource").val()};$.ajax({url:c,
type:"POST",dataType:"json",contentType:"application/json; charset=utf-8",data:JSON.stringify(b),success:function(a){a=a.Message;$("#loadingSpinner").hide();$("#sourceFeedback").show().html(a)},error:function(a){alert("Encountered a problem saving your Song. Please copy your song to another program until this issue is resolved.")}})}};return b}();
ugsEditorPlus.typeahead=function(){var b={},c=[],a={},h="",g,d=[],f=/\s{2,}/g,l=/([^a-z0-9]+)/gi,t=/['`\u2019-]/g,w=function(){$("li").each(function(b){var e=$(this);b=m(e.text());var d=e.children("a").attr("href"),k=d.toLowerCase(),e=e.children("a").html(),e=e.replace('<strong class="','<span class="bigger ').replace("</strong>","</span>");a[k]={html:e,searchText:b,code:k,href:d};c.push(k)})},m=function(a){return a.toLowerCase().replace(t,"").replace(l," ").replace(f," ").trim()},n=function(a,b){h=
m(a);d=h.split(" ");for(var e="",k=0;k<d.length;k++)d[k]=d[k].trim(),0<d[k].length&&(e+=(0<e.length?"|":"")+d[k]);g=new RegExp("("+e+")","gi");b(c)},k=function(c){window.location=a[c].href;return a[c].searchText},e=function(c){c=a[c];for(var b=0;b<d.length;b++)if(-1==c.searchText.indexOf(d[b]))return!1;return!0},p=function(c){return c.sort(function(c,b){return a[c].searchText>a[b].searchText})},q=function(c){c=$("<div/>").html(a[c].html);$("em, .bigger",c).each(function(a){a=$(this);var c=a.html();
a.html(c.replace(g,"<strong>$1</strong>"))});return c.html()};b.initialize=function(){w();$("#quickSearch").typeahead({source:n,updater:k,matcher:e,sorter:p,highlighter:q,minLength:2,items:50}).val("").focus()};return b};
ugsEditorPlus.resize=function(){var b={},c=null,a=null,h=null,g=null,d=!1,f=!1,l=function(b){c=$(b);$("body").append('<div id="aceHeader"><button class="aceSideBtn" title="Show options &amp; help"><span></span><span></span><span></span></button><strong>Edit Song</strong><a href="#exit-fullscreen">Exit fullscreen</a></div><div id="aceEditor"></div><div id="aceHelp"></div>');a=$("#aceEditor");a.fadeOut(1);h=$("#aceHelp");$("#aceHeader a").click(function(a){a.preventDefault();e()});$("#aceHeader button").click(t)},
t=function(a){a.preventDefault();w(!f)},w=function(c){(f=c)?(h.animate({left:0},400),a.animate({left:"350px"},400)):(h.animate({left:"-350px"},400),a.animate({left:0},400))},m=function(a){var c="",b,e;a=a.toLowerCase();$("script").each(function(d,m){b=m.src.toLowerCase();e=b.indexOf(a);0<e&&(c=m.src.substr(0,e))});return c},n=function(){d=!0;$("html").addClass("aceEditorActive");$(".overlay").fadeOut(300);if(null!==g)k();else{var a=m("ugsEditorPlus");LazyLoad.js(a+"/ace/ace.js",function(){g=ace.edit("aceEditor");
g.setTheme("ace/theme/idle_fingers");g.getSession().setMode("ace/mode/chordpro");g.setOptions({enableBasicAutocompletion:!0,enableSnippets:!0});g.completers=[ugsAce.chordCompleter];k();h.html(ugsAce.helpHtml)})}},k=function(){a.fadeIn(550);g.setValue($("#chordProSource").val());g.gotoLine(1);h.fadeIn(1)},e=function(){d=!1;c.show();a.fadeOut(550);h.fadeOut(550);null!==g&&$("#chordProSource").val(g.getValue());$("html").removeClass("aceEditorActive");w(!1)};b.toggle=function(a){null===c&&l(a);d?e():
n();return!1};return b}();ugsEditorPlus.chordBuilder=function(){var b={},c=null;b.init=function(){var b=$(".fingerToolImage").css("background-image");ugsChordBuilder.settings.cursor.imageUri=b.replace(/url\("(.*)hand.png"\)/i,"$1hand-cursor.png");c=new ugsChordBuilder.editorUi;c.init();$("#cdBldOpenBtn").click(a)};var a=function(a){a.preventDefault();c.reload();a=$(this).data("dialog");$("#"+a).fadeIn()};return b}();
ugsEditorPlus.songAmatic=function(){return{init:function(b){b=$.extend(ugsEditorPlus.options,{hideChordEnclosures:!ukeGeeks.settings.opts.retainBrackets,sortAlphabetical:ukeGeeks.settings.opts.sortAlphabetical,ignoreCommonChords:ukeGeeks.settings.opts.ignoreCommonChords,commonChords:ukeGeeks.settings.commonChords},"object"===typeof b?b:{});ukeGeeks.settings.opts.retainBrackets=!b.hideChordEnclosures;$("#songSourceDlg").toggle(b.showEditOnLoad);ukeGeeks.scriptasaurus.init(b.useLegacyIe);ugsEditorPlus.actions.init();
ugsEditorPlus.topMenus.init();ugsEditorPlus.submenuUi.init();ugsEditorPlus.optionsDlg.init();ugsEditorPlus.chordBuilder.init();ugsEditorPlus.actions.run()}}}();var ugsChordBuilder=window.ugsChordBuilder||{};ugsChordBuilder.version="1.0.6";ugsChordBuilder.entities={BoundingBox:function(b,c){this.x=b?b.x:0;this.y=b?b.y:0;this.width=c?c.width:1;this.height=c?c.height:1},Dot:function(b,c,a){this.string=b;this.fret=c?c:0;this.finger=a?a:0},Position:function(b,c){this.x=b?b:0;this.y=c?c:0}};
ugsChordBuilder.settings=function(){var b=ugsChordBuilder.entities,c={x:75,y:75},a={numFrets:5,maxFret:16,stringNames:["G","C","E","A"],strokeWidth:4,strokeColor:"#8F8569",fretSpace:35,stringSpace:30},h=function(){return{height:a.fretSpace,width:a.stringSpace}};return{anchorPos:c,cursor:{fillColor:"rgba(220, 216, 73, 0.35)",strokeWidth:1,strokeColor:"#AAB444",radius:9,imageUri:"/img/editor/hand-cursor.png"},fretBoard:a,dot:{fillColor:"#F68014",radius:11,strokeWidth:2,strokeColor:"#D56333",fontWeight:"bold",
fontFamily:'Arial, "Helvetica Neue", Helvetica, Verdana, sans-serif',fontSize:16,fontColor:"#ffffff"},fretLabel:{fontFamily:'Arial, "Helvetica Neue", Helvetica, Verdana, sans-serif',fontSize:28,color:"#6A6A63",lightColor:"#EAEAE8"},stringLabel:{fontFamily:'Arial, "Helvetica Neue", Helvetica, Verdana, sans-serif',fontSize:34,color:"#DCD849"},chord:{nameMaxLength:20},targetDimensions:h,targetAnchorPos:function(){var g=h();return new b.Position(c.x-.5*g.width,c.y-g.height-.2*a.strokeWidth)},centerAnchor:function(b){c.x=
.5*b.width-.5*(a.stringNames.length-1)*a.stringSpace-a.strokeWidth;c.y=.5*b.height-.5*a.numFrets*a.stringSpace}}}();
ugsChordBuilder.tracking=function(){var b=ugsChordBuilder.entities,c=ugsChordBuilder.settings,a={},h=null;a.toDot=function(a){var d=new b.BoundingBox(a),f;h||(f=c.targetDimensions(),f.width*=c.fretBoard.stringNames.length,f.height*=c.fretBoard.numFrets+1,h=new b.BoundingBox(c.targetAnchorPos(),f));f=h;if(!(d.x<f.x+f.width&&d.x+d.width>f.x&&d.y<f.y+f.height&&d.y+d.height>f.y))return null;d=c.targetDimensions();return new b.Dot(Math.floor((a.x-f.x)/d.width),Math.floor((a.y-f.y)/d.height))};return a}();
ugsChordBuilder.fretDots=function(){var b=ugsChordBuilder.entities,c=ugsChordBuilder.settings.anchorPos,a=ugsChordBuilder.settings.fretBoard,h=ugsChordBuilder.settings.dot,g={},d=[];g.getDots=function(){return d.slice()};g.slide=function(c){var b;a:{for(b=0;b<d.length;b++)if(1>d[b].fret+c||d[b].fret+c>a.numFrets){b=!1;break a}b=!0}if(!b)return!1;for(b=0;b<d.length;b++)d[b].fret+=c;return!0};g.toggleDot=function(a){if(0==a.fret)l(a.string);else{var b=f(a);0>b?d.push(a):d.splice(b,1)}};g.toggleFinger=
function(a,b){var c=f(a);if(0>c)return!1;d[c].finger=d[c].finger==b?0:b;return!0};g.reset=function(){for(var b=0;b<a.stringNames.length;b++)l(b)};var f=function(a){for(var b=d.length-1;0<=b;b--)if(d[b].string==a.string&&d[b].fret==a.fret)return b;return-1},l=function(a){for(var b=d.length-1;0<=b;b--)d[b].string==a&&d.splice(b,1)};g.draw=function(g){for(var f=d.length-1;0<=f;f--){var m;m=d[f];m=new b.Position(c.x+.47*a.strokeWidth+m.string*a.stringSpace,c.y+.47*a.strokeWidth+(m.fret-.5)*a.fretSpace);
var n=g,k=m;n.beginPath();n.arc(k.x,k.y,h.radius,0,2*Math.PI,!1);n.fillStyle=h.fillColor;n.fill();n.lineWidth=h.strokeWidth;n.strokeStyle=h.strokeColor;n.stroke();0<d[f].finger&&(n=g,k=d[f].finger,n.font=h.fontWeight+" "+h.fontSize+"px "+h.fontFamily,n.textAlign="center",n.fillStyle=h.fontColor,n.fillText(k,m.x,m.y+.3*h.fontSize))}};return g}();
ugsChordBuilder.cursorCanvas=function(){var b=ugsChordBuilder.settings.cursor,c=ugsChordBuilder.settings.dot,a={},h=null,g=null,d=!1,f=!0,l=1,t={x:0,y:0};a.init=function(a){h=a;w()};var w=function(){g=new Image;g.onload=function(){d=!0};g.src=b.imageUri};a.setCursor=function(a,b){f=a;l=b};a.draw=function(a){var n=b.radius+b.strokeWidth;h.clearRect(t.x-n,t.y-n,n+50,n+60);!d||f?(h.beginPath(),h.arc(a.x,a.y,b.radius,0,2*Math.PI,!1),h.fillStyle=b.fillColor,h.fill(),h.lineWidth=b.strokeWidth,h.strokeStyle=
b.strokeColor,h.stroke()):(h.drawImage(g,a.x,a.y),h.font=c.fontWeight+" "+c.fontSize+"px "+c.fontFamily,h.textAlign="left",h.fillStyle="black",h.fillText(l,a.x+.8*g.width,a.y+g.height));t=a};return a}();
ugsChordBuilder.chordCanvas=function(){var b=ugsChordBuilder.entities,c=ugsChordBuilder.settings.centerAnchor,a=ugsChordBuilder.settings.anchorPos,h=ugsChordBuilder.settings.fretLabel,g=ugsChordBuilder.settings.stringLabel,d=ugsChordBuilder.settings.fretBoard,f={},l=null,t=null;f.init=function(a,b){l=a;t=b;c(t)};f.draw=function(c,m){l.clearRect(0,0,t.width,t.height);for(var f=new b.Position(a.x-.3*h.fontSize,a.y+h.fontSize),k=1<m?h.color:h.lightColor,e=0;e<d.numFrets;e++){var p=m+e,q=f;l.font=h.fontSize+
"px "+h.fontFamily;l.textAlign="right";l.fillStyle=k;l.fillText(p,q.x,q.y);f.y+=d.fretSpace;k=h.lightColor}f=new b.Position(a.x+.5*d.strokeWidth,a.y-.25*h.fontSize);for(e=0;e<d.stringNames.length;e++)p=d.stringNames[e],k=f,l.font=g.fontSize+"px "+g.fontFamily,l.textAlign="center",l.fillStyle=g.color,l.fillText(p,k.x,k.y),f.x+=d.stringSpace;e=d.strokeWidth/2;p=d.numFrets*d.fretSpace;k=(d.stringNames.length-1)*d.stringSpace;l.beginPath();for(f=1;f<d.stringNames.length-1;f++)q=a.x+f*d.stringSpace+e,
l.moveTo(q,a.y+e),l.lineTo(q,a.y+p+e);for(f=1;f<d.numFrets;f++)q=a.y+f*d.fretSpace+e,l.moveTo(a.x+e,q),l.lineTo(a.x+k+e,q);l.rect(a.x+e,a.y+e,k,p);l.strokeStyle=d.strokeColor;l.lineWidth=d.strokeWidth;l.stroke();l.closePath();ugsChordBuilder.fretDots.draw(l)};return f}();
ugsChordBuilder["export"]=function(){var b=ugsChordBuilder.settings.fretBoard,c=ugsChordBuilder.settings.chord,a={},h=null,g=function(a,b){this.string=a;this.dots=b?b:[]},d=function(){var a,c=[];for(a=1;a<=b.stringNames.length;a++)c.push(new g(a));var d=ugsChordBuilder.fretDots.getDots();for(a=c.length-1;0<=a;a--)for(var e=d.length-1;0<=e;e--)c[a].string==d[e].string+1&&c[a].dots.push(d[e]);return c},f=function(a){for(var b=0,c=900,e=a.length-1;0<=e;e--)a[e].fret>b&&(b=a[e].fret),a[e].fret<c&&(c=
a[e].fret);return{max:b,min:900>c?c:b}},l=function(a){return 0<a?h+a:0},t=function(a,b){for(var c=0;c<a.length;c++)if(a[c].fret==b)return a[c].finger;return 0};a.getPrimaryFrets=function(a){h=a-1;a=d();for(var b=[],c=0;c<a.length;c++){var e=f(a[c].dots);b.push(l(e.max))}return b};a.getDefinition=function(a,b){var c=(a=w(a))&&0<a.length?a:"CHORDNAME",e="",g="",q="";h=b-1;for(var x=d(),u=0;u<x.length;u++){var B=f(x[u].dots),e=e+(l(B.max)+" "),g=g+(t(x[u].dots,B.max)+" ");B.max!=B.min&&(q+=" add: string "+
x[u].string+" fret "+l(B.min)+" finger "+t(x[u].dots,B.min))}return("{define: "+c+" frets "+e+" fingers "+g+q+"}").replace(/\s+/g," ").replace(" }","}")};a.getDefinitionHtml=function(b,c){b=w(b);var d=a.getDefinition(b,c),d=d.replace(" "+b," X07Myq791wso01"),d=d.replace(/\b(\d+)\b/g,'<span class="chordPro-X07MX001number">$1</span>'),d=d.replace(/\b(frets?|fingers?|string)\b/g,'<span class="chordPro-X07MX001attribute">$1</span>'),d=d.replace(/\b(define|add)\b/g,'<span class="chordPro-X07MX001keyword">$1</span>');
return d.replace("X07Myq791wso01",'<span class="chordPro-string">'+b+"</span>").replace(/X07MX001/g,"").replace(/ +/g," ")};var w=function(a){a=a.replace(/^\s*(.*?)\s*$/,"$1").replace(/\s+/g,"-");/^(frets|fingers|add:)$/i.test(a)&&(a="");return a.substring(0,c.nameMaxLength)};return a}();
ugsChordBuilder.chooserList=function(){var b={},c=[],a=null,h=0,g=null,d=function(){},f=null,l={showText:!1,height:50,width:40,fretSpace:9,stringSpace:7,dotRadius:3,lineWidth:1,topLeftPos:{x:10,y:2},xWidth:.7*7,xStroke:1.4},t={dot:"8pt Arial",text:"8pt Arial",fret:"8pt Arial"},w={fretLines:"#EED18E",dots:"#551D00",dotText:"#ffffff",text:"#000000",fretText:"#EED18E",xStroke:"#551D00"},m=function(a,b){this.id=h++;this.name=a;this.definition=b};b.init=function(b){d=b;a=document.getElementById("cdBldPick");
a.addEventListener("click",k,!1);n()};var n=function(){for(var b=/\{define:\s*([^}]+?)\s+frets[^}]+?\}/im,e=document.getElementById("chordProSource").value.split("\n"),d=e.length-1;0<=d;d--)b.test(e[d])&&A(e[d].replace(b,"$1"),e[d]);for(var e=a,d=c,f="",b=0;b<d.length;b++)f+=p(d[b].id,d[b].name);e.innerHTML='<li data-id="-1" class="newChord">+ Add New Chord</li>'+f;e=e.getElementsByTagName("li");for(b=e.length-1;0<=b;b--)1>b||q(e[b].getAttribute("data-id"))};b.reset=function(){c=[];document.getElementById("cdBldPick").innerHTML=
"";h=0;g=null;n()};b.show=function(a){document.getElementById("cdBldChooserPanel").style.display=a?"block":"none";document.getElementById("cdBldBuilderPanel").style.display=a?"none":"block";$("#cdBldChooserPanel").closest(".overlay").toggleClass("chordBuilderNarrow",a)};b.save=function(d){var f;a:{f=null==g?-1:g.id;for(var h=d.name.toLowerCase(),C=c.length-1;0<=C;C--)if(""+c[C].id!=""+f&&c[C].name.toLowerCase()==h){f=C;break a}f=-1}if(0<=f)return alert("Hey, this chord name is already being used."),
!1;f=-1;if(null==g){f=A(d.name,d.definition);g=y(f);d=d.definition;for(var h=document.getElementById("chordProSource"),C=/\s*\{\s*(title|t|artist|subtitle|st|album|define):.*?\}/im,k=h.value.split("\n"),l="",m=!1,n=k.length-1;0<=n;n--)!m&&C.test(k[n])&&(l=d+"\n"+l,m=!0),l=k[n]+"\n"+l;m||(l=d+"\n"+h.value);h.value=l;ugsEditorPlus.actions.run()}else{h=B(g.id);if(0>h)return!1;C=c[h].definition;c[h].name=d.name;c[h].definition=d.definition;f=c[h].id;u(C,c[h].definition)}d=y(f);(h=e(f))?h.innerHTML=p(f,
d.name,!0):(d=d.name,h=document.createElement("ul"),h.innerHTML=p(f,d),a.appendChild(h.childNodes[0]));q(f);b.show(!0);return!0};var k=function(c){c.preventDefault();g=y(c.target.getAttribute("data-id"));if("delete"==c.target.getAttribute("data-action")){if(c=g,confirm('Delete definition for "'+c.name+'"?')){var f=e(c.id);f&&(a.removeChild(f),u(c.definition,""))}}else{c=null;if(null!=g){c=ukeGeeks.chordImport.runLine(g.definition);a:{if(c.muted)for(f=0;f<c.muted.length;f++)if(c.muted[f]){f=!0;break a}f=
!1}f&&alert("Uh-oh! This chord uses muted strings!\nCurrently the Chord Builder does not support muted strings -- \nsaving edits will result in mutes being lost.")}d(c);b.show(!1)}},e=function(b){for(var c=a.getElementsByTagName("li"),e=0;e<c.length;e++)if(c[e].getAttribute("data-id")==""+b)return c[e];return null},p=function(a,b,c){c=2<arguments.length?c:!1;var e='<span class="deleteChord" data-id="'+a+'" data-action="delete" title="Remove this definition"></span>'+b;return c?e:'<li data-id="'+a+
'" title="Edit this definition" class="ugs-grouped">'+e+"</li>"},q=function(a){var b=e(a);a=y(a);a=ukeGeeks.chordImport.runLine(a.definition);null==f&&(f=new ukeGeeks.chordBrush);f.plot(b,a,l,t,w)},x=function(a,b,c){var e=a.replace(b,c);return e==a?a:x(e,b,c)},u=function(a,b){var c=document.getElementById("chordProSource");c.value=x(c.value,a,b);ugsEditorPlus.actions.run()},B=function(a){for(var b=0;b<c.length;b++)if(""+c[b].id==a)return b;return-1},y=function(a){a=B(a);return 0<=a?c[a]:null},A=function(a,
b){var e=new m(a,b);c.push(e);return e.id};return b}();
ugsChordBuilder.editorUi=function(){var b=null,c=null,a=null,h=1,g="",d=!0,f=0,l={0:"None",1:"Index finger",2:"Middle finger",3:"Ring finger",4:"Pinkie"};this.init=function(){b=document.getElementById("cdBldCursorCanvas");if(!b.getContext)return!1;for(var e=b.getContext("2d"),d=document.getElementById("cdBldDiagramCanvas").getContext("2d"),f=document.getElementById("cdBldStartingFret"),h="",g=ugsChordBuilder.settings.fretBoard.maxFret-ugsChordBuilder.settings.fretBoard.numFrets+1,l=1;l<=g;l++)h+=
'<option value="'+l+'">'+l+"</option>";f.innerHTML=h;f.addEventListener("change",u,!1);document.getElementById("cdBldChordName").addEventListener("keyup",x,!1);c=document.getElementById("cdBldDotsBtn");a=document.getElementById("cdBldFingersBtn");c.addEventListener("click",p,!1);a.addEventListener("click",p,!1);document.getElementById("cdBldShowOutputBtn").addEventListener("click",w,!1);document.getElementById("cdBldCancelBtn").addEventListener("click",m,!1);document.getElementById("cdBldSaveBtn").addEventListener("click",
n,!1);document.getElementById("toolboxSlideUpBtn").addEventListener("click",B,!1);document.getElementById("toolboxSlideDownBtn").addEventListener("click",B,!1);t();document.getElementById("cdBldEditorSurface").addEventListener("mousemove",y,!1);b.addEventListener("click",A,!1);ugsChordBuilder.chordCanvas.init(d,b);ugsChordBuilder.cursorCanvas.init(e);z();v();ugsChordBuilder.chooserList.init(k);return!0};var t=function(){f++;4<f&&(f=0);document.getElementById("cdBldBtnFingerName").innerHTML=l[f]+" ("+
f+")";document.getElementById("cdBldBtnDiagram").className="fingerToolImage finger"+f},w=function(a){q(document.getElementById("cdBldOutputBox"),"collapseOutput",!a.target.checked)},m=function(a){a.preventDefault();e();ugsChordBuilder.chooserList.show(!0)},n=function(a){a.preventDefault();a={name:g,startingFret:h,dots:ugsChordBuilder.fretDots.getDots(),definition:ugsChordBuilder["export"].getDefinition(g,h)};ugsChordBuilder.chooserList.save(a)||(a=document.getElementById("cdBldChordName"),a.focus(),
a.select())},k=function(a){if(null==a)e();else{var b;b=a.dots;for(var c=0,d=0;d<b.length;d++)b[d].fret>c&&(c=b[d].fret);b=c;b=b>ugsChordBuilder.settings.fretBoard.numFrets?b-ugsChordBuilder.settings.fretBoard.numFrets+1:1;c=e;d=a.name;a=a.dots;for(var f=b-1,h=[],g=0;g<a.length;g++){var k=a[g].fret-f;h.push(new ugsChordBuilder.entities.Dot(a[g].string,0>k?0:k,a[g].finger))}c(d,b,h,!1)}},e=function(b,e,k,p){p=3<arguments.length?p:!0;ugsChordBuilder.fretDots.reset();var l=p;g=b&&0<b.length?b:"CHORDNAME";
document.getElementById("cdBldChordName").value=g;h=e?e:1;document.getElementById("cdBldStartingFret").value=h;document.getElementById("cdBldShowOutputBtn").checked=!1;q(document.getElementById("cdBldOutputBox"),"collapseOutput",!0);document.getElementById("cdBldSaveBtn").value=l?"Add":"Update";d=!0;f=0;t();q(c,"selected",d);q(a,"selected",!d);q(document.getElementById("cdBldToolbox"),"open",!d);ugsChordBuilder.cursorCanvas.setCursor(d,f);if(k&&0<k.length)for(l=0;l<k.length;l++)ugsChordBuilder.fretDots.toggleDot(k[l]);
z();v()},p=function(b){b.preventDefault();b=0<=b.currentTarget.href.indexOf("#dots");b==d?b||(t(),ugsChordBuilder.cursorCanvas.setCursor(d,f)):(q(c,"selected",b),q(a,"selected",!b),q(document.getElementById("cdBldToolbox"),"open",!b),d=b,ugsChordBuilder.cursorCanvas.setCursor(d,f))},q=function(a,b,c){var e=0<=a.className.indexOf(b);c&&!e?a.className+=" "+b:!c&&e&&(a.className=a.className.replace(b,"").replace(/\s+/g," "))},x=function(a){g=this.value;v()},u=function(a){h=parseInt(this.value,10);v();
z()},B=function(a){a.preventDefault();var b=!1;a="up"==a.target.getAttribute("data-direction")?-1:1;if(ugsChordBuilder.fretDots.slide(a))b=!0;else{a=h+a;var c=ugsChordBuilder.settings.fretBoard.maxFret-ugsChordBuilder.settings.fretBoard.numFrets+1;1<=a&&a<=c&&(h=a,document.getElementById("cdBldStartingFret").value=a,b=!0)}b&&(z(),v())},y=function(a){ugsChordBuilder.cursorCanvas.draw(r(this,a))},A=function(a){a=r(b,a);var c=ugsChordBuilder.tracking.toDot(a);c&&(d?(ugsChordBuilder.fretDots.toggleDot(c),
z(a),v()):ugsChordBuilder.fretDots.toggleFinger(c,f)&&(z(a),v()))},r=function(a,b){var c=a.getBoundingClientRect();return new ugsChordBuilder.entities.Position(b.clientX-c.left,b.clientY-c.top)},z=function(a){a=a||new ugsChordBuilder.entities.Position(0,0);ugsChordBuilder.chordCanvas.draw(a,h)},v=function(){document.getElementById("cdBldOutput").innerHTML=ugsChordBuilder["export"].getDefinitionHtml(g,h)};this.reload=function(){e();ugsChordBuilder.chooserList.reset();ugsChordBuilder.chooserList.show(!0)}};
LazyLoad=function(b){function c(a,c){var d=b.createElement(a),f;for(f in c)c.hasOwnProperty(f)&&d.setAttribute(f,c[f]);return d}function a(a){var b=w[a],c,d;b&&(c=b.callback,d=b.urls,d.shift(),m=0,d.length||(c&&c.call(b.context,b.obj),w[a]=null,n[a].length&&g(a)))}function h(){var a=navigator.userAgent;l={async:!0===b.createElement("script").async};(l.webkit=/AppleWebKit\//.test(a))||(l.ie=/MSIE|Trident/.test(a))||(l.opera=/Opera/.test(a))||(l.gecko=/Gecko\//.test(a))||(l.unknown=!0)}function g(e,
g,k,m,u){var B=function(){a(e)},y="css"===e,A=[],r,z,v,C;l||h();if(g)if(g="string"===typeof g?[g]:g.concat(),y||l.async||l.gecko||l.opera)n[e].push({urls:g,callback:k,obj:m,context:u});else for(r=0,z=g.length;r<z;++r)n[e].push({urls:[g[r]],callback:r===z-1?k:null,obj:m,context:u});if(!w[e]&&(C=w[e]=n[e].shift())){t||(t=b.head||b.getElementsByTagName("head")[0]);g=C.urls.concat();r=0;for(z=g.length;r<z;++r)k=g[r],y?v=l.gecko?c("style"):c("link",{href:k,rel:"stylesheet"}):(v=c("script",{src:k}),v.async=
!1),v.className="lazyload",v.setAttribute("charset","utf-8"),l.ie&&!y&&"onreadystatechange"in v&&!("draggable"in v)?v.onreadystatechange=function(){/loaded|complete/.test(v.readyState)&&(v.onreadystatechange=null,B())}:y&&(l.gecko||l.webkit)?l.webkit?(C.urls[r]=v.href,f()):(v.innerHTML='@import "'+k+'";',d(v)):v.onload=v.onerror=B,A.push(v);r=0;for(z=A.length;r<z;++r)t.appendChild(A[r])}}function d(b){var c;try{c=!!b.sheet.cssRules}catch(f){m+=1;200>m?setTimeout(function(){d(b)},50):c&&a("css");return}a("css")}
function f(){var b=w.css,c;if(b){for(c=k.length;0<=--c;)if(k[c].href===b.urls[0]){a("css");break}m+=1;b&&(200>m?setTimeout(f,50):a("css"))}}var l,t,w={},m=0,n={css:[],js:[]},k=b.styleSheets;return{css:function(a,b,c,d){g("css",a,b,c,d)},js:function(a,b,c,d){g("js",a,b,c,d)}}}(this.document);
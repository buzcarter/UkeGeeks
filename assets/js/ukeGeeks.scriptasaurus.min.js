/**
 * <ul>
 * <li>Project: UkeGeeks' Scriptasaurus</li>
 * <li>Version: 1.5.1</li>
 * <li>Homepage: http://ukegeeks.com</li>
 * <li>Project Repository: https://github.com/buzcarter/UkeGeeks</li>
 * <li>Author: Buz Carter</li>
 * <li>Contact: buz@ukegeeks.com</li>
 * <li>Copyright: Copyright 2010-2014 Buz Carter.</li>
 * <li>License GNU General Public License (http://www.gnu.org/licenses/gpl.html)</li>
 * </ul>
 *
 * <h3>Overview</h3>
 * <p>Reads marked-up music (lyrics + chords) extracting all of the chords used;
 * Generates a chord diagrams using HTML5 &lt;canvas&gt; and rewrites the music with
 * standard HTML wrapping the chords.</p>
 *
 * @module ukeGeeks
 * @main ukeGeeks
 */
var ukeGeeks = window.ukeGeeks || {};
;ukeGeeks.definitions=function(){var a={},g=[],e=[],d=[],f=0,b=[];a.instrument={sopranoUke:0,baritoneUke:5};a.addInstrument=function(b){"object"===typeof b&&(b=b.join("\n"));d.push(b)};a.useInstrument=function(c){c=0<arguments.length?c:a.instrument.sopranoUke;f=parseInt(c,10);0<f&&(b=ukeGeeks.transpose.retune(f));a.setChords(ukeGeeks.chordImport.runBlock(d[0]).chords)};a.get=function(c){var d,e,a;for(d=0;d<g.length;d++)if(c==g[d].name)return g[d];if(1>f)return h(c);a=k(c);for(d in b)if(a==b[d].original&&
(e=h(b[d].transposed)))return c=new ukeGeeks.data.expandedChord(c),c.dots=e.dots,c.muted=e.muted,c;return null};var c={"A#":"Bb",Db:"C#","D#":"Eb",Gb:"F#",Ab:"G#"},k=function(b){var d=b.substr(0,2);return c[d]?c[d]+b.substr(2):b},h=function(c){var b,d=k(c);for(b=0;b<e.length;b++)if(d==e[b].name)return c=new ukeGeeks.data.expandedChord(c),c.dots=e[b].dots,c.muted=e[b].muted,c;return null};a.add=function(c){if(c.length)for(var b=0;b<c.length;b++)g.push(c[b]);return g.length};a.replace=function(c){g=
[];return a.add(c)};a.getChords=function(){return e};a.setChords=function(c){e=c};return a}();
ukeGeeks.settings=function(){var a={fonts:{dot:"9pt Arial Black,Arial",text:"bold 14pt Arial",fret:"bold 13pt Arial"},colors:{fretLines:"#003366",dots:"#ff0000",dotText:"#ffffff",text:"#000000",fretText:"#4a4a4a",xStroke:"#444444"},fretBox:{showText:!0,height:150,width:100,fretSpace:20,stringSpace:20,dotRadius:8,lineWidth:1.6,topLeftPos:{x:22,y:25},xWidth:9,xStroke:1.6*1.6},inlineFretBox:{showText:!1,height:50,width:40,fretSpace:9,stringSpace:7,dotRadius:3,lineWidth:1,topLeftPos:{x:10,y:2},xWidth:.7*
7,xStroke:1.4,fonts:{dot:"8pt Arial",text:"8pt Arial",fret:"8pt Arial"}},ids:{songText:"ukeSongText",canvas:"ukeChordsCanvas",container:"ukeSongContainer"},wrapClasses:{wrap:"ugs-song-wrap",diagrams:"ugs-diagrams-wrap",text:"ugs-source-wrap"},opts:{columnsEnabled:!0,retainBrackets:!1,ignoreCommonChords:!1,sortAlphabetical:!1,autoFixOverlaps:!0},inlineDiagrams:!1,numFrets:5,tuning:["G","C","E","A"]};a.defaultInstrument=ukeGeeks.definitions.instrument.sopranoUke;a.tabs={lineSpacing:16,noteSpacing:14,
lineWidth:1,lineColor:"#999999",labelWidth:12,labelFont:"10pt Arial, Helvetica, Verdana, Geneva, sans-serif",dotColor:"#eaeaea",dotRadius:10,textFont:"bold 12pt Arial, Helvetica, Verdana, Geneva, sans-serif",textColor:"#000000",bottomPadding:10};a.environment={isIe:!1};a.commonChords="A B C D E F G Am".split(" ");var g=function(d,f){if("number"==typeof d)return d*f;if("object"==typeof d)for(var b in d)d[b]=g(d[b],f);return d},e=/\b(\d+)(pt|px)\b/;a.scale=function(d){if(1!=d){for(var f in this.fonts){var b=
this.fonts,c=f,a;a=this.fonts[f];var h=d,q=a.match(e);2>q.length||(h*=parseInt(q[1],10),a=a.replace(e,h+q[2]));b[c]=a}this.fretBox=g(this.fretBox,d)}};return a}();
ukeGeeks.data=function(){return{expandedChord:function(a){this.name=a;this.dots=[];this.muted=[]},song:function(){this.body=this.key=this.st2=this.st=this.artist=this.album=this.title="";this.hasChords=!1;this.ugsMeta=[];this.defs=[];this.chords=[]},dot:function(a,g,e){this.string=a;this.fret=g;this.finger=e},instrument:function(a,g,e,d){this.key=a;this.name=g;this.tuning=e;this.chords=d},htmlHandles:function(a,g,e){this.wrap=a;this.diagrams=g;this.text=e}}}();
ukeGeeks.toolsLite=function(){var a={},g=/\s{2,}/g,e=/^\s+|\s+$/g;a.addClass=function(d,f){a.hasClass(d,f)||(d.className+=" "+f)};a.hasClass=function(d,f){return d.className.match(new RegExp("(\\s|^)"+f+"(\\s|$)"))};a.removeClass=function(d,f){a.hasClass(d,f)&&(d.className=d.className.replace(new RegExp("(\\s|^)"+f+"(\\s|$)")," "))};a.setClass=function(d,f,b){b?a.addClass(d,f):a.removeClass(d,f)};a.trim=function(d){return d.replace(e,"")};a.pack=function(d){return d.replace(g," ").replace(e,"")};
a.getElementsByClass=function(d,f,b){var c;f||(f=document);if(f.getElementsByClassName)return f.getElementsByClassName(d);var a=[];b||(b="*");f=f.getElementsByTagName(b);b=f.length;var e=new RegExp("(^|\\s)"+d+"(\\s|$)");for(c=d=0;d<b;d++)e.test(f[d].className)&&(a[c]=f[d],c++);return a};return a}();
ukeGeeks.chordImport=function(){var a={},g=function(c,b){this.define=c;this.adds=b},e=/\s*{?define\s*:(.*?)(}|add:)/i,d=/(add:.*?)(}|add:)/i,f=/(\S+)\s+/,b=/\s+frets\s+([\dx]{4}|(([\dx]{1,2}\s){3})[\dx]{1,2})/i,c=/\s+fingers\s+((\d\s+){3}\d|\d{4})/i,k=/add:\s*string\s*(\S+)\s+fret\s+(\d+)\sfinger\s(\d)/i,h=/{\s*instrument\s*:\s*(.*?)\s*}/i,q=/{\s*tuning\s*:\s*(\S+)\s+(\S+)\s+(\S+)\s+(\S+)\s*}/i,n=/(\d{1,2}|x)/gi,m=/(.)/g,t=function(c){var b=ukeGeeks.toolsLite.pack(c);if(1<b.length&&"#"!=b[0]&&(c=
b.match(e))&&1<c.length){c=c[1];for(var f=[],a=b.match(d);a&&1<a.length;)f.push(a[1]),b=b.replace(a[1],""),a=b.match(d);return new g(c,f)}return null},l=function(d,a){var e=[],q=[];var h=d.match(b);if(h)for(var h=4==h[1].length?h[1].match(m):h[1].match(n),g=0;g<h.length;g++){var l="x"==h[g]||"X"==h[g];e[g]=l?0:parseInt(h[g],10);q[g]=l}h=(h=d.match(f))?h[1]:null;(g=d.match(c))?(g=g[1],4==g.length&&(g=g.replace(m,"$1 ")),g=g.split(" ")):g=[];if(null===h||"frets"==h)return u.push('bad "define" instruction: chord name not found: '+
d),null;if(null===e)return u.push('bad "define" instruction: frets not found: '+d),null;for(var h=new ukeGeeks.data.expandedChord(h),l=g,g=[],t=ukeGeeks.settings.tuning,A=0;A<t.length;A++){var C=parseInt(e[A],10);0<C&&g.push(new ukeGeeks.data.dot(A,C,l.length-1>=A?parseInt(l[A],10):0))}if(a&&!(1>a.length))for(var D in a)(e=a[D].match(k))&&2<e.length&&g.push(new ukeGeeks.data.dot(parseInt(e[1],10)-1,parseInt(e[2],10),parseInt(e[3],10)));h.dots=g;h.muted=q;return h},u=[];a.runLine=function(c){return(c=
t(c))?l(c.define,c.adds):null};a.runBlock=function(c){var b=c.split("\n");2>b.length&&(b=c.split("{"));var d=b,b=[],a;for(a in d){var f=t(d[a]);f&&b.push(f)}a=(a=c.match(h))?ukeGeeks.toolsLite.pack(a[1]):null;c=(c=c.match(q))?[c[1],c[2],c[3],c[4]]:null;var d=ukeGeeks.data.instrument,f=a.replace(" ","-"),e;for(e in c)f+="-"+c[e];e=f.toLowerCase();var f=[],k=null,g;for(g in b)(k=l(b[g].define,b[g].adds))&&f.push(k);return new d(e,a,c,f)};return a}();
ukeGeeks.transpose=function(){var a={},g=/^([A-G][#b]?)(.*)/,e={A:0,"A#":1,Bb:1,B:2,C:3,"C#":4,Db:4,D:5,"D#":6,Eb:6,E:7,F:8,"F#":9,Gb:9,G:10,"G#":11,Ab:11};a.shift=function(d,a){var b;b=d.match(g);b=!b||1>b.length?null:{tone:parseInt(e[b[1]],10),prefix:b[1],suffix:b[2]};if(null===b)return null;var c=(b.tone+a)%12;0>c&&(c+=12);for(var k in e)if(c==e[k])return k+b.suffix;return null};a.retune=function(){var d=0<arguments.length?arguments[0]:0,f=ukeGeeks.definitions.getChords(),b=[];if(0===d)for(var c in f)b.push({original:f[c].name,
transposed:f[c].name});else for(var e in f)b.push({original:f[e].name,transposed:a.shift(f[e].name,d)});return b};a.shiftChords=function(d,f){for(var b=[],c=0;c<d.length;c++)b.push(a.shift(d[c],f));return b};return a}();ukeGeeks.definitions.sopranoUkuleleGcea="{instrument: Soprano Ukulele};{tuning: G C E A};{define: A frets 2 1 0 0 fingers 1 2 0 0};{define: Am frets 2 0 0 0 fingers 1 0 0 0};{define: A7 frets 0 1 0 0 fingers 0 1 0 0};{define: A7sus4 frets 0 2 0 0 fingers 0 2 0 0};{define: Am7 frets 0 0 0 0};{define: Adim frets 2 3 2 3 fingers 1 3 2 4};{define: Amaj7 frets 1 1 0 0 fingers 1 2 0 0};{define: A6 frets 2 4 2 4 fingers 1 3 2 4};{define: Asus2 frets 2 4 5 2 fingers 2 3 4 1};{define: Asus4 frets 2 2 0 0 fingers 1 2 0 0};{define: Aaug frets 2 1 1 4 fingers 2 1 1 4 add: string 1 fret 1 finger 1 add: string 4 fret 1 finger 1};{define: Am6 frets 2 4 2 3 fingers 1 3 1 2 add: string 2 fret 2 finger 1};{define: A9 frets 0 1 0 2 fingers 0 1 0 2};{define: Bb frets 3 2 1 1 fingers 3 2 1 1};{define: Bbm frets 3 1 1 1 fingers 3 1 1 1 add: string 1 fret 1 finger 1};{define: Bb7 frets 1 2 1 1 fingers 1 2 1 1 add: string 2 fret 1 finger 1};{define: Bb7sus4 frets 1 3 1 1 fingers 1 3 1 1 add: string 2 fret 1 finger 1};{define: Bbm7 frets 1 1 1 1 fingers 1 1 1 1};{define: Bbdim frets 0 1 0 1 fingers 0 1 0 2};{define: Bbmaj7 frets 2 2 1 1 fingers 2 2 1 1};{define: Bb6 frets 0 2 1 1 fingers 0 2 1 1};{define: Bbm6 frets 0 1 1 1 fingers 0 1 1 1};{define: Bbsus2 frets 3 0 1 1 fingers 3 0 1 1};{define: Bbsus4 frets 3 3 1 1 fingers 3 3 1 1};{define: Bbaug frets 3 2 2 5 fingers 2 1 1 4 add: string 1 fret 2 finger 1 add: string 4 fret 2 finger 1};{define: Bb9 frets 1 2 1 3 fingers 2 1 4 3};{define: Bbmaj7 frets 2 2 1 1 fingers 2 2 1 1};{define: Bbm7-5 frets 1 1 0 1 fingers 1 2 0 3};{define: B frets 4 3 2 2 fingers 3 2 1 1};{define: Bm frets 4 2 2 2 fingers 3 1 1 1 add: string 1 fret 2 finger 1};{define: Bm6 frets 1 2 2 2 fingers 1 2 3 4};{define: B7 frets 2 3 2 2 fingers 1 2 1 1 add: string 2 fret 2 finger 1};{define: B7sus4 frets 2 4 2 2 fingers 1 3 1 1 add: string 2 fret 2 finger 1};{define: Bm7 frets 2 2 2 2 fingers 1 1 1 1};{define: Bdim frets 1 2 1 2 fingers 1 3 2 4};{define: Bmaj7 frets 3 3 2 2 fingers 2 2 1 1};{define: B6 frets 1 3 2 2 fingers 1 4 2 3};{define: Bsus2 frets 5 1 2 2 fingers 4 1 3 2};{define: Bsus4 frets 4 4 2 2 fingers 2 2 1 1};{define: Baug frets 0 3 3 2 fingers 0 2 2 1};{define: B9 frets 2 3 2 4};{define: C frets 0 0 0 3 fingers 0 0 0 3};{define: Cm frets 0 3 3 3 fingers 0 1 2 3};{define: C7 frets 0 0 0 1 fingers 0 0 0 1};{define: C7sus4 frets 0 0 1 1 fingers 0 0 1 1};{define: Cm7 frets 3 3 3 3 fingers 1 1 1 1};{define: Cdim frets 2 3 2 3 fingers 1 3 2 4};{define: Cmaj7 frets 0 0 0 2 fingers 0 0 0 1};{define: C6 frets 0 0 0 0};{define: Cm6 frets 0 3 5 5 fingers 0 1 3 1};{define: Csus2 frets 0 2 3 3 fingers 0 1 2 2};{define: Csus4 frets 0 0 1 3 fingers 0 0 1 3};{define: Caug frets 1 0 0 3 fingers 1 0 0 4};{define: C9 frets 0 2 0 1 fingers 0 2 0 1};{define: C# frets 1 1 1 4 fingers 1 1 1 4 add: string 4 fret 1 finger 1};{define: C#m frets 1 4 4 4 fingers 1 2 3 3};{define: C#7 frets 1 1 1 2 fingers 1 1 1 2 add: string 4 fret 1 finger 1};{define: C#7sus4 frets 1 1 2 2 fingers 1 1 2 3};{define: C#m7 frets 1 4 4 2 fingers 1 3 3 2};{define: C#dim frets 0 1 0 1 fingers 0 1 0 2};{define: C#maj7 frets 1 1 1 3 fingers 1 1 1 3 add: string 4 fret 1 finger 1};{define: C#6 frets 1 1 1 1 fingers 1 1 1 1};{define: C#m6 frets 1 1 0 1 fingers 1 2 0 3};{define: C#sus2 frets 1 3 4 4 fingers 1 2 3 3};{define: C#sus4 frets 1 1 2 4 fingers 1 1 2 4};{define: C#aug frets 2 1 1 4 fingers 2 1 1 4 add: string 1 fret 1 finger 1 add: string 4 fret 1 finger 1};{define: C#9 frets 1 3 1 2};{define: D frets 2 2 2 0 fingers 1 1 1 0};{define: Dm frets 2 2 1 0 fingers 2 2 1 0};{define: Dm6 frets 0 2 1 2 fingers 0 2 1 3};{define: D7 frets 2 2 2 3 fingers 1 1 1 2 add: string 4 fret 2 finger 1};{define: D7sus4 frets 2 2 3 3 fingers 1 1 2 3};{define: Dm7 frets 2 2 1 3 fingers 2 2 1 3};{define: Ddim frets 1 2 1 2 fingers 1 3 2 4};{define: Dmaj7 frets 2 2 2 4 fingers 1 1 1 2 add: string 4 fret 2 finger 1};{define: D6 frets 2 2 2 2 fingers 2 2 2 2};{define: Dsus2 frets 2 2 0 0 fingers 1 2 0 0};{define: Dsus4 frets 0 2 3 0 fingers 0 1 2 0};{define: Daug frets 3 2 2 5 fingers 2 1 1 4 add: string 1 fret 2 finger 1 add: string 4 fret 2 finger 1};{define: D9 frets 2 4 2 3};{define: Eb frets 0 3 3 1 fingers 0 2 2 1};{define: Ebm frets 3 3 2 1 fingers 3 3 2 1};{define: Eb7 frets 3 3 3 4 fingers 1 1 1 2 add: string 4 fret 3 finger 1};{define: Eb7sus4 frets 3 3 4 4 fingers 1 1 2 3};{define: Ebm7 frets 3 3 2 4 fingers 2 2 1 4};{define: Ebdim frets 2 3 2 3 fingers 1 3 2 4};{define: Ebmaj7 frets 3 3 3 5 fingers 1 1 1 2 add: string 4 fret 3 finger 1};{define: Eb6 frets 3 3 3 3 fingers 1 1 1 1};{define: Ebm6 frets 3 3 2 3 fingers 2 3 1 4};{define: Ebsus2 frets 3 3 1 1 fingers 2 2 1 1};{define: Ebsus4 frets 1 3 4 1 fingers 2 3 4 1};{define: Ebaug frets 0 3 3 2 fingers 0 2 2 1};{define: Eb9 frets 0 1 1 1};{define: E frets 4 4 4 2 fingers 2 3 4 1};{define: Em frets 0 4 3 2 fingers 0 3 2 1};{define: E7 frets 1 2 0 2 fingers 1 2 0 3};{define: E7sus4 frets 2 2 0 2 fingers 2 3 0 4};{define: Em6 frets 4 4 3 4 fingers 2 3 1 4};{define: Em7 frets 0 2 0 2 fingers 0 1 0 2};{define: Edim frets 0 1 0 1 fingers 0 1 0 2};{define: Emaj7 frets 1 3 0 2 fingers 1 3 0 2};{define: E6 frets 4 4 4 4 fingers 1 1 1 1};{define: Esus2 frets 4 4 2 2 fingers 3 3 1 1};{define: Esus4 frets 2 4 0 2 fingers 2 4 0 1};{define: Eaug frets 1 0 0 3 fingers 1 0 0 4};{define: E9 frets 1 2 2 2};{define: F frets 2 0 1 0 fingers 2 0 1 0};{define: Fm frets 1 0 1 3 fingers 1 0 2 4};{define: F7 frets 2 3 1 0 fingers 2 3 1 0};{define: F7sus4 frets 3 3 1 3 fingers 2 3 1 4};{define: Fm6 frets 1 2 1 3 fingers 1 2 1 3 add: string 2 fret 1 finger 1 add: string 4 fret 1 finger 1};{define: Fm7 frets 1 3 1 3 fingers 1 3 2 4};{define: Fdim frets 1 2 1 2 fingers 1 3 2 4};{define: Fmaj7 frets 5 5 0 0 fingers 1 2 0 0};{define: F6 frets 2 2 1 3 fingers 2 2 1 4};{define: Fsus2 frets 0 0 1 3 fingers 0 0 1 3};{define: Fsus4 frets 3 0 1 3 fingers 3 0 1 4};{define: F6sus2 frets 0 0 1 3 fingers 0 0 1 3};{define: F6sus4 frets 3 0 1 1 fingers 3 0 1 1};{define: F6aug frets 2 1 1 4 fingers 2 1 1 4 add: string 1 fret 1 finger 1 add: string 4 fret 1 finger 1};{define: F9 frets 2 3 3 3};{define: Faug frets 2 1 1 0 fingers 3 1 2 0};{define: F# frets 3 1 2 1 fingers 3 1 2 1 add: string 1 fret 1 finger 1 add: string 3 fret 1 finger 1};{define: F#m frets 2 1 2 0 fingers 2 1 3 0};{define: F#7 frets 3 4 2 4 fingers 2 3 1 4};{define: F#7sus4 frets 4 4 2 4 fingers 2 3 1 4};{define: F#m7 frets 2 4 2 4 fingers 1 3 2 4};{define: F#dim frets 2 3 2 3 fingers 1 3 2 4};{define: F#maj7 frets 3 5 2 4 fingers 2 4 1 3};{define: F#m6 frets 2 1 2 4 fingers 2 1 3 4};{define: F#6 frets 3 3 2 4 fingers 2 2 1 4};{define: F#sus2 frets 1 1 2 4 fingers 1 1 2 4};{define: F#sus4 frets 4 1 2 2 fingers 4 1 2 3};{define: F#aug frets 3 2 2 5 fingers 2 1 1 4 add: string 1 fret 2 finger 1 add: string 4 fret 2 finger 1};{define: F#9 frets 1 1 0 1};{define: G frets 0 2 3 2 fingers 0 1 3 2};{define: Gm frets 0 2 3 1 fingers 0 2 3 1};{define: Gm6 frets 0 2 0 1 fingers 0 2 0 1};{define: G7 frets 0 2 1 2 fingers 0 2 1 3};{define: G7sus4 frets 0 2 1 3 fingers 0 2 1 4};{define: Gm7 frets 0 2 1 1 fingers 0 2 1 1};{define: Gdim frets 0 1 0 1 fingers 0 1 0 2};{define: Gmaj7 frets 0 2 2 2 fingers 0 1 2 3};{define: G6 frets 0 2 0 2 fingers 0 1 0 2};{define: Gsus2 frets 0 2 3 0 fingers 0 1 2 0};{define: Gsus4 frets 0 2 3 3 fingers 0 1 2 3};{define: Gaug frets 0 3 3 2 fingers 0 2 2 1};{define: Gsus4 frets 0 2 3 3};{define: G9 frets 2 2 1 2};{define: G# frets 5 3 4 3 fingers 3 1 2 1 add: string 1 fret 3 finger 1 add: string 3 fret 3 finger 1};{define: G#m frets 1 3 4 2 fingers 1 3 4 2};{define: G#7 frets 1 3 2 3 fingers 1 3 2 4};{define: G#7sus4 frets 1 3 2 4 fingers 1 3 2 4};{define: G#m7 frets 1 3 2 2 fingers 1 4 2 3};{define: G#dim frets 1 2 1 2 fingers 1 3 2 4};{define: G#maj7 frets 1 3 3 3 fingers 1 2 2 3};{define: G#6 frets 1 3 1 3 fingers 1 3 2 4};{define: G#m6 frets 1 3 1 2 fingers 1 3 1 2 add: string 2 fret 1 finger 1 add: string 4 fret 1 finger 1};{define: G#sus2 frets 1 3 4 1 fingers 2 3 4 1};{define: G#sus4 frets 1 3 4 4 fingers 1 2 3 3};{define: G#aug frets 1 0 0 3 fingers 1 0 0 4};{define: G#9 frets 1 0 2 1 fingers 1 0 3 2};{define: C-F frets 2 0 1 3};{define: D/A frets 2 2 2 0};{define: Dm/C frets 2 2 1 3};{define: Fm7/C frets 1 3 1 3};{define: G/B frets 0 2 3 2};{define: G/F# frets 0 2 2 2};{define: G/F frets 0 2 1 2};{define: G7/B frets 0 2 1 2}".split(";");
ukeGeeks.image=function(){this.__context={root:{},layer:null,current:null}};
ukeGeeks.image.prototype={newImage:function(a,g){var e={type:"image",dimensions:{height:g,width:a},layers:[]};this.__context.root=e;this.__context.current=e;return this},__newLayer:function(a){if(!this.__context.current.layers)return this;a.style=null;this.__context.current.layers.push(a);a.type&&"group"===a.type?this.__context.current=a:this.__context.layer=a;return this},newGroup:function(a){this.__newLayer({type:"group",name:a,layers:[]});this.__context.layer=null;return this},endGroup:function(){this.__context.current=
this.__context.root;return this},circle:function(a,g,e){return this.__newLayer({type:"circle",center:{x:a,y:g},radius:e})},rectangle:function(a,g,e,d){return this.__newLayer({type:"rectangle",pos:{x:a,y:g},width:e,height:d})},line:function(a,g,e,d){return this.__newLayer({type:"line",endPoints:[{x:a,y:g},{x:e,y:d}]})},hLine:function(a,g,e){return this.line(a,g,a+(e||1),g)},vLine:function(a,g,e){return this.line(a,g,a,g+(e||1))},text:function(a,g,e){return this.__newLayer({type:"text",pos:{x:a,y:g},
text:e})},style:function(a){var g=this.__context.layer?this.__context.layer:this.__context.current;if(!g||g.style)return this;g.style=a;return this},getData:function(){return this.__context.root}};
ukeGeeks.imageSvg=function(){function a(d,a){if(!a)return null;var b="",c,e,g;for(g in a)if(a.hasOwnProperty(g)){e=a[g];switch(g){case "fillColor":c="fill";break;case "fontFamily":c="font";break;case "textAlign":c="text-anchor";switch(e){case "right":e="end";break;case "left":e="start";break;default:e="middle"}break;case "strokeColor":c="stroke";break;case "strokeWidth":c="stroke-width";break;default:c=null}c&&e&&(b+=c+":"+e+";")}"text"!==d||a.textAlign||(b+="text-anchor:middle;");return b}function g(d){for(var e=
"",b,c,k=0;k<d.length;k++)if(b=d[k],"group"===b.type)c=a("group",b.style),e+="<g "+(b.name?'id="'+b.name+'"':"")+' style="'+c+'" >'+g(b.layers,b.style)+"</g>";else{c="";var h=a(b.type,b.style);h&&(h=' style="'+h+'"');switch(b.type){case "line":c='<line  x1="'+b.endPoints[0].x+'" y1="'+b.endPoints[0].y+'"  x2="'+b.endPoints[1].x+'" y2="'+b.endPoints[1].y+'" '+h+" />";break;case "circle":c='<circle cx="'+b.center.x+'" cy="'+b.center.y+'" r="'+b.radius+'" '+h+" />";break;case "rectangle":c='<rect x="'+
b.pos.x+'" y="'+b.pos.y+'" width="'+b.width+'" height="'+b.height+'" '+h+" />";break;case "text":c='<text x="'+b.pos.x+'" y="'+b.pos.y+'" '+h+">"+b.text+"</text>"}e+=c}return e}function e(d){return'<?xml version="1.0" encoding="utf-8"?><svg version="1.1" xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" viewBox="0 0 '+d.dimensions.width+" "+d.dimensions.height+'" width="'+d.dimensions.width+'px" height="'+d.dimensions.height+'px">'+g(d.layers)+"</svg>"}return{toString:function(d){return e(d.getData())},
appendChild:function(d,a,b){var c=document.createElement("span");b&&c.setAttribute("class",b);c.innerHTML=e(a.getData());d.appendChild(c);return c}}}();
ukeGeeks.imageCanvas=function(){function a(a){for(var d={},f=0;f<arguments.length;f++)if(arguments[f]&&"object"===typeof arguments[f]){var b=arguments[f],c;for(c in b)d[c]=b[c]}return d}function g(e,d,f){for(var b,c=0;c<d.length;c++)if(b=d[c],"group"===b.type)g(e,b.layers,b.style);else{var k=e,h=b;b=a(h.style,f||null);switch(h.type){case "line":k.beginPath();k.moveTo(h.endPoints[0].x,h.endPoints[0].y);k.lineTo(h.endPoints[1].x,h.endPoints[1].y);k.strokeStyle=b.strokeColor||"black";k.lineWidth=b.strokeWidth||
1;k.stroke();k.closePath();break;case "circle":k.beginPath();k.arc(h.center.x,h.center.y,h.radius,0,2*Math.PI,!0);k.closePath();k.fillStyle=b.fillColor||"black";k.fill();break;case "rectangle":k.beginPath();k.rect(h.pos.x,h.pos.y,h.width,h.height);k.strokeStyle=b.strokeColor||"black";k.lineWidth=b.strokeWidth||1;k.stroke();k.closePath();break;case "text":k.fillText&&(k.font=b.fontFamily||"9pt Arial",k.textAlign=b.textAlign||"center",k.fillStyle=b.fillColor||b.color||"black",k.fillText(h.text,h.pos.x,
h.pos.y))}}}return{appendChild:function(a,d){var f=d.getData(),b;b=f.dimensions.width;var c=f.dimensions.height,k=document.createElement("canvas");k?(a.appendChild(k),k.width=b,k.height=c,b=(b=k.getContext("2d"))?b:null):b=null;if(!b)return!1;g(b,f.layers);return b}}}();
ukeGeeks.chordBrush=function(){return{init:function(){},plot:function(a,g,e,d,f){var b,c,k=(new ukeGeeks.image).newImage(e.width,e.height);if(k){d||(d=ukeGeeks.settings.fonts);f||(f=ukeGeeks.settings.colors);var h=e.topLeftPos.x,q=e.topLeftPos.y;c=f.fretLines;var n=e.lineWidth/2,m=ukeGeeks.settings.numFrets*e.fretSpace;b=3*e.stringSpace;var t=k.newGroup("fretboard").style({fillColor:"none",strokeColor:c,strokeWidth:e.lineWidth});for(c=1;3>c;c++)t.vLine(h+c*e.stringSpace+n,q+n,m);for(c=1;c<ukeGeeks.settings.numFrets;c++)t.hLine(h+
n,q+c*e.fretSpace+n,b);t.rectangle(h+n,q+n,b,m);t.endGroup();n=q+e.dotRadius;m=(e.fretSpace-2*e.dotRadius)/2;b=g.dots;c=-1;for(var t=300,l=0;l<b.length;l++)b[l].fret>c&&(c=b[l].fret),b[l].fret<t&&(t=b[l].fret);b=300>t?t:0;c=0<c?c:0;t=5>=c?1:c-4;for(l=0;l<g.dots.length;l++){var u=h+g.dots[l].string*e.stringSpace,p=m+n+(g.dots[l].fret-t)*e.fretSpace;k.circle(u,p,e.dotRadius).style({fillColor:f.dots});0<g.dots[l].finger&&e.showText&&4<e.dotRadius&&k.text(u,p+5,g.dots[l].finger).style({fillColor:f.dotText,
fontFamily:d.dot})}1!=t&&(n=q+.96*e.fretSpace*(5-(c-b)),k.text(0,n,b).style({fontFamily:d.fret,fillColor:f.fretText,textAlign:"left"}),1<c-b&&(n=q+4.8*e.fretSpace,k.text(0,n,c).style({fontFamily:d.fret,fillColor:f.fretText,textAlign:"left"})));e.showText&&k.text(h+1.5*e.stringSpace,q-5,g.name).style({fontFamily:d.text,fillColor:f.text});g=g.muted;f=f.xStroke;d=e.topLeftPos.x+e.lineWidth/2;h=e.topLeftPos.y+e.lineWidth/4;for(q=0;q<g.length;q++)g[q]&&(c=k,n=d+q*e.stringSpace,m=h,b=e,t=f,n-=b.xWidth/
2,m-=b.xWidth/2,c=c.newGroup("X").style({strokeColor:t||"black",strokeWidth:b.xStroke}),c.line(n,m,n+b.xWidth,m+b.xWidth),c.line(n,m+b.xWidth,n+b.xWidth,m));ukeGeeks.imageSvg.appendChild(a,k,"ugs-diagrams--chord-img")}}}};
ukeGeeks.chordParser=function(){var a={},g=[];a.init=function(){};a.parse=function(a){var d,f,b=a.match(/\[(.+?)]/img);if(b){var c=[],k;for(d=0;d<b.length;d++){k=!1;for(f=0;f<c.length;f++)if(c[f]==b[d]){k=!0;break}k||c.push(b[d])}for(f in c)c[f]=c[f].replace("[","").replace("]","");g=c}else g=[];d=g;f=ukeGeeks.settings.opts.retainBrackets?"[":" ";var b=ukeGeeks.settings.opts.retainBrackets?"]":" ",h;for(h in d)for(;a.length!=(a=a.replace("["+d[h]+"]",'<code data-chordName="'+d[h]+'"><strong>'+f+"<em>"+
d[h]+"</em>"+b+"</strong></code>")).length;);h=a;ukeGeeks.settings.inlineDiagrams?(a=/(<\/strong><\/code>)[ \t]*(<code data-chordName="[^"]*"><strong>)/ig,a=h.replace(a,'$1<span class="ugsInlineSpacer">&nbsp;</span>$2')):(a=/<\/strong><\/code>[ \t]*<code data-chordName="[^"]*"><strong>/ig,a=h.replace(a," "));return a};a.getChords=function(){return g};return a};
ukeGeeks.cpmParser=function(){var a={},g=1,e=!1,d="";a.init=function(){};a.parse=function(a){var n=new ukeGeeks.data.song;a=a.replace(/<\/?pre>/img,"").replace(/\x3c!--(.|\n)*?--\x3e/gm,"");var m;a=a.split("\n");var t=[],l=null,u,p;for(p in a)0<a[p].length&&"#"==a[p][0]||((u=f.blocks.test(a[p]))||null===l?(null!==l&&t.push(l),l=a[p],l={type:f.chorusBlock.test(l)?c.ChorusBlock:f.tabBlock.test(l)?c.TabBlock:c.TextBlock,lines:[]},u||l.lines.push(a[p])):(u=ukeGeeks.toolsLite.trim(a[p]),0<u.length&&l.lines.push(u)));
0<l.lines.length&&t.push(l);p=t;a=/\{[^}]+?:.*?\}/im;var t=/\{.+?:(.*)\}/gi,l=/\{(.+?)\s*:.*\}/gi,r;for(r in p)for(var v in p[r].lines)if(a.test(p[r].lines[v])){u=p[r].lines[v].replace(t,"$1");var y=p[r].lines[v].replace(l,"$1").toLowerCase(),y=y.replace(/\r/,""),x={type:"",lines:[]};switch(y){case "title":case "t":x.type=c.Title;break;case "artist":x.type=c.Artist;break;case "subtitle":case "st":x.type=c.Subtitle;break;case "album":x.type=c.Album;break;case "comment":case "c":x.type=c.Comment;break;
case "key":case "k":x.type=c.Key;break;case "define":x.type=c.ChordDefinition;break;case "ukegeeks-meta":x.type=c.UkeGeeksMeta;break;default:x.type="Undefined-"+y}x.lines[0]=ukeGeeks.toolsLite.trim(u);p[r].lines[v]=x}r=p;v=/\s*{\s*(column_break|colb|np|new_page)\s*}\s*/im;for(var z in r)for(var B in r[z].lines)if(v.test(r[z].lines[B]))switch(r[z].lines[B].replace(v,"$1").toLowerCase()){case "column_break":case "colb":g++;r[z].lines[B]={type:c.ColumnBreak,lines:[]};break;case "new_page":case "np":r[z].lines[B]=
{type:c.NewPage,lines:[]}}z=r;B=/\[(.+?)]/i;r=/\[(.+?)]/img;for(m in z)if(z[m].type==c.TextBlock||z[m].type==c.ChorusBlock)for(var w in z[m].lines)a=z[m].lines[w],"string"==typeof a&&(v=B.test(a),e=e||v,p=v&&1>ukeGeeks.toolsLite.trim(a.replace(r,"")).length,z[m].lines[w]={type:p?c.ChordOnlyText:v?c.ChordText:c.PlainText,lines:[a]},v&&""===d&&(v=a.match(B))&&(d=v[1]));m=z;n.body=k(m);1<g&&(n.body='<div class="'+b.ColumnWrap+" "+b.ColumnCount+g+'"><div class="'+b.Column+'">'+n.body+"</div></div>");
n.hasChords=e;w=h(m,c.Title);0<w.length&&(n.title=w[0]);w=h(m,c.Artist);0<w.length&&(n.artist=w[0]);w=h(m,c.Subtitle);0<w.length&&(n.st=w[0]);1<w.length&&(n.st2=w[1]);w=h(m,c.Album);0<w.length&&(n.album=w[0]);w=h(m,c.UkeGeeksMeta);0<w.length&&(n.ugsMeta=w);w=h(m,c.Key);0<w.length?n.key=w[0]:""!==d&&(n.key=d);w=h(m,c.ChordDefinition);if(0<w.length)for(var A in w)n.defs.push(ukeGeeks.chordImport.runLine("{define: "+w[A]+"}"));return n};var f={blocks:/\s*{\s*(start_of_tab|sot|start_of_chorus|soc|end_of_tab|eot|end_of_chorus|eoc)\s*}\s*/im,
tabBlock:/\s*{\s*(start_of_tab|sot)\s*}\s*/im,chorusBlock:/\s*{\s*(start_of_chorus|soc)\s*}\s*/im},b={Comment:"ugsComment",Tabs:"ugsTabs",Chorus:"ugsChorus",PreChords:"ugsChords",PrePlain:"ugsPlain",NoLyrics:"ugsNoLyrics",ColumnWrap:"ugsWrap",ColumnCount:"ugsColumnCount",Column:"ugsColumn",NewPage:"ugsNewPage"},c={TextBlock:1,ChorusBlock:2,TabBlock:3,Comment:101,Title:102,Subtitle:103,Album:104,ChordDefinition:105,UkeGeeksMeta:106,ColumnBreak:107,Artist:108,NewPage:109,Key:110,ChordText:201,PlainText:202,
ChordOnlyText:203,Undefined:666},k=function(a){for(var d="",e=0;e<a.length;e++)if(a[e].type==c.Comment)d+='<h6 class="'+b.Comment+'">'+a[e].lines[0]+"</h6>\n";else if(a[e].type==c.NewPage)d+='<hr class="'+b.NewPage+'" />\n';else if(a[e].type==c.ChordText||a[e].type==c.PlainText||a[e].type==c.ChordOnlyText){if(!(1>a[e].lines[0].length)){var f=a[e].type==c.PlainText?b.PrePlain:b.PreChords;a[e].type==c.ChordOnlyText&&(f+=" "+b.NoLyrics);var g=a[e].type,h=0<=e-1?a[e-1].type:c.Undefined,p=e+1<a.length?
p=a[e+1].type:c.Undefined,d=d+(h!=g?'<pre class="'+f+'">':"\n"),d=d+a[e].lines[0],d=d+(p!=g?"</pre>\n":"")}}else if(a[e].type==c.ChorusBlock)d+='<div class="'+b.Chorus+'">\n',d+=k(a[e].lines),d+="</div>\n";else if(a[e].type==c.TabBlock){var d=d+('<pre class="'+b.Tabs+'">'),r;for(r in a[e].lines)d+=a[e].lines[r]+"\n";d+="</pre>\n"}else a[e].type==c.TextBlock?d+=k(a[e].lines):a[e].type==c.ColumnBreak&&(d+='</div><div class="'+b.Column+'">');return d},h=function(a,d){var b=[],e;for(e in a)if(a[e].type==
d)b.push(a[e].lines[0]);else if(a[e].type==c.TextBlock)for(var f in a[e].lines)a[e].lines[f].type==d&&b.push(a[e].lines[f].lines[0]);return b};return a};
ukeGeeks.chordPainter=function(){var a={},g=null,e=[],d=null,f=[],b=/^(n.?\/?c.?|tacet)$/i;a.init=function(a){g=new ukeGeeks.chordBrush;g.init();d=a};a.show=function(a){d.diagrams.innerHTML="";e=[];f=[];ukeGeeks.settings.opts.sortAlphabetical&&a.sort();for(var k=0;k<a.length;k++)if(!b.test(a[k])){var h;if(h=ukeGeeks.settings.opts.ignoreCommonChords)a:{for(h=0;h<ukeGeeks.settings.commonChords.length;h++)if(a[k]==ukeGeeks.settings.commonChords[h]){h=!0;break a}h=!1}h?"function"===typeof Array.prototype.indexOf&&
-1==f.indexOf(a[k])&&f.push(a[k]):(h=ukeGeeks.definitions.get(a[k]))?g.plot(d.diagrams,h,ukeGeeks.settings.fretBox):e.push(a[k])}0<f.length&&(a=document.createElement("p"),a.className="ugsIgnoredChords",a.innerHTML="Also uses: "+f.sort().join(", "),d.diagrams.appendChild(a))};a.showInline=function(a){var b=d.text.getElementsByTagName("code");if(!(1>b.length))for(var e=0;e<a.length;e++){var f=ukeGeeks.definitions.get(a[e]);if(f)for(var n=0;n<b.length;n++)b[n].getAttribute("data-chordName")==f.name&&
g.plot(b[n],f,ukeGeeks.settings.inlineFretBox,ukeGeeks.settings.inlineFretBox.fonts)}};a.getErrors=function(){return e};a.getIgnoredChords=function(){return f};return a};
ukeGeeks.tabs=function(){var a=ukeGeeks.settings.tabs,g=function(e,d,f){if(!f)return a.noteSpacing*e[0].length+d+a.dotRadius;f=e[0].length;var b=a.dotRadius;"|"==e[0][f-1]&&(--f,b=0);return a.noteSpacing*f+d+b};return{init:function(){},replace:function(e){e=e.getElementsByTagName("pre");for(var d in e)if("ugsTabs"==e[d].className){var f=e[d].innerHTML;e[d].innerHTML="";var b=e[d],f=f.split("\n"),c=[],k=void 0;for(k in f){var h=ukeGeeks.toolsLite.trim(f[k]);0<h.length&&c.push(h);if(4==c.length){var q=
c,c=b,n=void 0,h=void 0,q="string"==typeof q?q.split("\n"):q;if(!(4>q.length)){if(h="G"==q[3][0])for(var n=q,m=0;4>m;m++)n[m]=n[m].substr(1);for(var n=q,m=/([0-9]+)/g,t=[],l=0;4>l;l++)t[l]=n[l].match(m);for(var n=t,m=q,t=/([0-9]{2})/g,l=/([0-9])/g,u=[],p=0;4>p;p++)u[p]=m[p].replace(t,"-*"),u[p]=u[p].replace(l,"*");m=u;t=0;l=void 0;u=/-+$/gi;for(p=0;p<q.length;p++)l=q[p].trim().replace(u,""),l.length>t&&(t=l.length);l="";for(q=0;q<t;q++)l="|"==m[0][q]?l+"|":l+("*"==m[0][q]||"*"==m[1][q]||"*"==m[2][q]||
"*"==m[3][q]?"*":"-");q=/--/g;l=l.replace(q,"- ");q=/ -/g;for(u=l;;){l=l.replace(q,"  ");if(l==u)break;u=l}for(var q=m,m=l,l=[],u="",r=p=void 0,v=void 0,y=void 0,r=0;4>r;r++)l.push([]);for(r=0;4>r;r++)for(p=y=v=0;p<t;p++)" "!=m[p]&&("*"==q[r][p]?(u=n[r][y],y++):u="|"==m[p]?"|":"-",l[r][v]=u,v++);n=l;l=h?a.labelWidth:0;m=n;n=3*a.lineSpacing+2*a.dotRadius+a.bottomPadding;c="string"==typeof c?document.getElementById(c):c;n=(new ukeGeeks.image).newImage(g(m,l,!1),n);t=a.dotRadius+l;q=1+a.dotRadius;l=
g(m,l,!0);p=a.lineWidth/2;u=t+p;p=q+p;r=n.newGroup("staff").style({strokeColor:a.lineColor,strokeWidth:a.lineWidth});for(v=0;4>v;v++)r.hLine(u,p,l),p+=a.lineSpacing;r.endGroup();a:for(r in v=void 0,u=0,p=q,r=void 0,m){if(3<r)break a;var u=t,x;for(x in m[r])v=m[r][x],"|"==v?(y=parseInt(x,10),v=a,y=y+1<m[r].length-1&&"|"==m[r][y+1]||y==m[r].length-1&&"|"==m[r][y-1],n.vLine((x==m[r].length-1?t+l:u)+v.lineWidth/2,q,3*v.lineSpacing).style({strokeColor:v.lineColor,strokeWidth:(y?4.5:1)*v.lineWidth})):isNaN(v)||
(n.circle(u,p,a.dotRadius).style({fillColor:a.dotColor}),n.text(u,p+.5*a.dotRadius,v).style({fontFamily:a.textFont,fillColor:a.textColor})),u+=a.noteSpacing;p+=a.lineSpacing}if(h)for(h=ukeGeeks.settings.tuning.slice(0).reverse(),m=0;4>m;m++)n.text(1,q+(m+.3)*a.lineSpacing,h[m]).style({fontFamily:a.labelFont,fillColor:a.lineColor,textAlign:"left"});c.innerHTML=ukeGeeks.imageSvg.toString(n)}c=[]}}}}}};
ukeGeeks.overlapFixer=function(){var a={},g=function(a){for(var f=a,b={top:0,left:0,right:0,width:0};f&&!isNaN(f.offsetLeft)&&!isNaN(f.offsetTop);)b.left+=f.offsetLeft-f.scrollLeft,b.top+=f.offsetTop-f.scrollTop,f=f.offsetParent;b.width=e(a);if(a=a.getElementsByTagName("em")[0])a=e(a),a>b.width&&(b.width=a+2);b.right=b.left+b.width;return b},e=function(a){return"undefined"!==typeof a.clip?a.clip.width:a.style.pixelWidth?a.style.pixelWidth:a.offsetWidth};a.Fix=function(a){var e=a.getElementsByTagName("code");
for(a=0;a<e.length;a++)e[a].style.paddingRight="0px";for(a=0;a<e.length-1;a++){var b=e[a],c=e[a+1],k=b.getElementsByTagName("strong")[0],c=c.getElementsByTagName("strong")[0];k&&c&&(k=g(k),c=g(c),k.top!=c.top||c.left>k.right||c.right<k.left?0:c.left>k.left&&c.left<k.right||c.right>k.left&&c.right<k.right)&&(k=k.right-c.left+1,b.style.paddingRight=(1>k?1:k)+"px")}};return a}();
ukeGeeks.scriptasaurus=function(){var a=[],g=function(e){var d=new ukeGeeks.cpmParser;d.init();d=d.parse(e.text.innerHTML);ukeGeeks.definitions.replace(d.defs);var f=new ukeGeeks.chordParser;f.init();e.text.innerHTML=f.parse(d.body);d.chords=f.getChords();f=new ukeGeeks.chordPainter;f.init(e);f.show(d.chords);ukeGeeks.settings.inlineDiagrams&&(ukeGeeks.toolsLite.addClass(e.wrap,"ugsInlineDiagrams"),f.showInline(d.chords));var b=new ukeGeeks.tabs;b.init();b.replace(e.text);a.push(f.getErrors());(f=
e.wrap)&&ukeGeeks.toolsLite.setClass(f,"ugsNoChords",!d.hasChords);ukeGeeks.settings.opts.autoFixOverlaps&&ukeGeeks.overlapFixer.Fix(e.text);return d};return{init:function(a){var d=ukeGeeks.definitions;ukeGeeks.settings.environment.isIe=a;d.addInstrument(d.sopranoUkuleleGcea);d.useInstrument(d.instrument.sopranoUke);ukeGeeks.settings.defaultInstrument!=d.instrument.sopranoUke&&d.useInstrument(ukeGeeks.settings.defaultInstrument)},run:function(){var e=new ukeGeeks.data.htmlHandles(document.getElementById(ukeGeeks.settings.ids.container),
document.getElementById(ukeGeeks.settings.ids.canvas),document.getElementById(ukeGeeks.settings.ids.songText));if(!(e&&e.diagrams&&e.text&&e.wrap))return null;a=[];e=g(e);var d=a[0];if(!(1>d.length)){for(var f="",b=0;b<d.length;b++)f+=0<f.length?", ":"",f+=d[b];alert("Forgive me, but I don't know the following chords: "+f)}return e},runByClasses:function(){for(var a=[],d=ukeGeeks.toolsLite.getElementsByClass(ukeGeeks.settings.wrapClasses.wrap),f=0;f<d.length;f++){var b;b=d[f];var c=ukeGeeks.toolsLite.getElementsByClass(ukeGeeks.settings.wrapClasses.diagrams,
b),k=ukeGeeks.toolsLite.getElementsByClass(ukeGeeks.settings.wrapClasses.text,b);b=void 0===c||1>c.length||void 0===k||1>k.length?null:new ukeGeeks.data.htmlHandles(b,c[0],k[0]);null!==b&&a.push(g(b))}return a},setTuningOffset:function(a){ukeGeeks.definitions.useInstrument(a)}}}();